/*!
 * maptalks.plotsymbol v0.3.0
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
/*!
 * requires maptalks@>=0.44.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function n(t,e){this.x=t,this.y=e}var r=n;n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t};var i={getArrowBody:function(t,e,n,i,o){e/=2;for(var s,u,a,h,c,l,p,f,y=0,g=[],d=[],_=1,x=t.length;_<x;_++)a=new r(t[_].x,t[_].y),h=new r(t[_-1].x,t[_-1].y),s=i&&o?(1-(1-i)*(y+=a.dist(h))/o)*e:e,c=_<x-1?new r(t[_+1].x,t[_+1].y):null,l=a.sub(h)._unit()._perp(),1===_&&(u=this._getPlotPair(t[_-1],l,e,n),g.push(u[0]),d.push(u[1])),c?(f=c.sub(a)._unit()._perp(),p=this._getJoinNormal(l,f)):p=l,u=this._getPlotPair(t[_],p,s,n),g.push(u[0]),d.push(u[1]);return[g,d]},_getJoinNormal:function(t,e){var n=t.add(e)._unit(),r=1/(n.x*e.x+n.y*e.y);return n._mult(r)},_getPlotPair:function(t,e,n,r){var i=e.x*n,o=e.y*n;return[t.add(i,o),t.add(-i,-o)]}},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],o=Object.getOwnPropertyDescriptor(e,i);o&&o.configurable&&void 0===t[i]&&Object.defineProperty(t,i,o)}}(t,e))},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(t){function n(){return o(this,n),u(this,t.apply(this,arguments))}return s(n,t),n.fromJSON=function(t){var e=t.feature,r=new n(e.geometry.coordinates,t.options);return r.setProperties(e.properties),r},n.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"StraightArrow"}},n.prototype._getPaintParams=function(){var t=this.getMap().getGLScale(),e=this._getPath2DPoints(this._getPrjCoordinates());if(e.length<=1)return null;var n=this._get2DLength()*this.options.widthRatio,r=i.getArrowBody(e,n,this.getMap()),o=r[0][r[0].length-1],s=r[1][r[1].length-1],u=this._getArrowHead(o,s,e[e.length-1],n),a=[];a.push.apply(a,r[0]),a.push.apply(a,u);for(var h=r[1].length-1;h>=0;h--)a.push(r[1][h]);return a=a.map(function(e){return e.multi(t)}),[a,[r[0].length,u.length,r[1].length]]},n.prototype._paintOn=function(t,n,r,i,o,s){t.beginPath();var u,a=0;t.moveTo(n[0].x,n[0].y),u=n.slice(0,r[0]),this._quadraticCurve(t,u),a+=r[0],e.Canvas._path(t,n.slice(a,a+r[1]),s,i),a+=r[1],t.lineTo(n[a].x,n[a].y),u=n.slice(a,a+r[2]),this._quadraticCurve(t,u),this._closeArrow(t,n[n.length-1],n[0]),e.Canvas._stroke(t,i),e.Canvas.fillCanvas(t,o,n[0].x,n[0].y)},n.prototype._closeArrow=function(t){t.closePath()},n.prototype._getArrowHead=function(t,e,n,i,o){o||(o=1),t=new r(t.x,t.y),e=new r(e.x,e.y);var s=t.sub(e)._unit(),u=n.add(i*s.x,i*s.y),a=n.add(i*-s.x,i*-s.y);s._perp()._mult(-1);return[u,n.add(o*i*s.x,o*i*s.y),a]},n}(e.Curve);a.mergeOptions({widthRatio:.1,arrowStyle:[]}),a.registerJSONType("StraightArrow"),e.DrawTool.registerMode("StraightArrow",{action:["click","mousemove","dblclick"],create:function(t){return new a(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var h=function(t){function e(){return o(this,e),u(this,t.apply(this,arguments))}return s(e,t),e.fromJSON=function(t){var n=t.feature,r=new e(n.geometry.coordinates,t.options);return r.setProperties(n.properties),r},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DiagonalArrow"}},e.prototype._getPaintParams=function(){var t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var e=this.getMap().getGLScale(),n=this._get2DLength(),r=n*this.options.widthRatio,o=i.getArrowBody(t,r,this.getMap(),.15,n),s=o[0][o[0].length-1],u=o[1][o[1].length-1],a=this._getArrowHead(s,u,t[t.length-1],.3*r,2),h=[];h.push.apply(h,o[0]),h.push.apply(h,a);for(var c=o[1].length-1;c>=0;c--)h.push(o[1][c]);return h=h.map(function(t){return t.multi(e)}),[h,[o[0].length,a.length,o[1].length]]},e}(a);h.mergeOptions({widthRatio:.2,arrowStyle:[]}),h.registerJSONType("DiagonalArrow"),e.DrawTool.registerMode("DiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new h(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var c=function(t){function e(){return o(this,e),u(this,t.apply(this,arguments))}return s(e,t),e.fromJSON=function(t){var n=t.feature,r=new e(n.geometry.coordinates,t.options);return r.setProperties(n.properties),r},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DoveTailDiagonalArrow"}},e.prototype._closeArrow=function(t,e,n){var i=new r(e.x,e.y),o=new r(n.x,n.y),s=new r(i.x+o.x,i.y+o.y).mult(.5),u=i.dist(o),a=i.sub(o)._unit()._perp(),h=s.x+.618*u*a.x,c=s.y+.618*u*a.y;t.lineTo(h,c),t.closePath()},e}(h);c.mergeOptions({widthRatio:.2,arrowStyle:[]}),c.registerJSONType("DoveTailDiagonalArrow"),e.DrawTool.registerMode("DoveTailDiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new c(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),t.StraightArrow=a,t.DiagonalArrow=h,t.DoveTailDiagonalArrow=c,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.plotsymbol v0.3.0, requires maptalks@>=0.44.0.")});