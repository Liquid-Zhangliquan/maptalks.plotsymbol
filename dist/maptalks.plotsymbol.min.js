/*!
 * maptalks.plotsymbol v0.2.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@>=0.36.2 
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],n):n(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,n){"use strict";function e(t,n){this.x=t,this.y=n}var r=e;e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,e=t.y-this.y;return n*n+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,e=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),e=Math.sin(t),r=n*this.x-e*this.y,i=e*this.x+n*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,n){var e=Math.cos(t),r=Math.sin(t),i=n.x+e*(this.x-n.x)-r*(this.y-n.y),o=n.y+r*(this.x-n.x)+e*(this.y-n.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t};var i={getArrowBody:function(t,n,e,i,o){n/=2;for(var s,u,a,h,c,l,p,f,y=0,g=[],d=[],_=1,x=t.length;_<x;_++)a=new r(t[_].x,t[_].y),h=new r(t[_-1].x,t[_-1].y),s=i&&o?(1-(1-i)*(y+=a.dist(h))/o)*n:n,c=_<x-1?new r(t[_+1].x,t[_+1].y):null,l=a.sub(h)._unit()._perp(),1===_&&(u=this._getPlotPair(t[_-1],l,n,e),g.push(u[0]),d.push(u[1])),c?(f=c.sub(a)._unit()._perp(),p=this._getJoinNormal(l,f)):p=l,u=this._getPlotPair(t[_],p,s,e),g.push(u[0]),d.push(u[1]);return[g,d]},_getJoinNormal:function(t,n){var e=t.add(n)._unit(),r=1/(e.x*n.x+e.y*n.y);return e._mult(r)},_getPlotPair:function(t,n,e,r){var i=n.x*e,o=n.y*e;return[t.add(i,o),t.add(-i,-o)]}},o=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},s=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):function(t,n){for(var e=Object.getOwnPropertyNames(n),r=0;r<e.length;r++){var i=e[r],o=Object.getOwnPropertyDescriptor(n,i);o&&o.configurable&&void 0===t[i]&&Object.defineProperty(t,i,o)}}(t,n))},u=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},a=function(t){function e(){return o(this,e),u(this,t.apply(this,arguments))}return s(e,t),e.fromJSON=function(t){var n=t.feature,r=new e(n.geometry.coordinates,t.options);return r.setProperties(n.properties),r},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"StraightArrow"}},e.prototype._getPaintParams=function(){var t=this.getMap().getGLScale(),n=this._getPath2DPoints(this._getPrjCoordinates());if(n.length<=1)return null;var e=this._get2DLength()*this.options.widthRatio,r=i.getArrowBody(n,e,this.getMap()),o=r[0][r[0].length-1],s=r[1][r[1].length-1],u=this._getArrowHead(o,s,n[n.length-1],e),a=[];a.push.apply(a,r[0]),a.push.apply(a,u);for(var h=r[1].length-1;h>=0;h--)a.push(r[1][h]);return a=a.map(function(n){return n.multi(t)}),[a,[r[0].length,u.length,r[1].length]]},e.prototype._paintOn=function(t,e,r,i,o,s){t.beginPath();var u,a=0;t.moveTo(e[0].x,e[0].y),u=e.slice(0,r[0]),this._quadraticCurve(t,u),a+=r[0],n.Canvas._path(t,e.slice(a,a+r[1]),s,i),a+=r[1],t.lineTo(e[a].x,e[a].y),u=e.slice(a,a+r[2]),this._quadraticCurve(t,u),this._closeArrow(t,e[e.length-1],e[0]),n.Canvas._stroke(t,i),n.Canvas.fillCanvas(t,o,e[0].x,e[0].y)},e.prototype._closeArrow=function(t){t.closePath()},e.prototype._getArrowHead=function(t,n,e,i,o){o||(o=1),t=new r(t.x,t.y),n=new r(n.x,n.y);var s=t.sub(n)._unit(),u=e.add(i*s.x,i*s.y),a=e.add(i*-s.x,i*-s.y);s._perp()._mult(-1);return[u,e.add(o*i*s.x,o*i*s.y),a]},e}(n.Curve);a.mergeOptions({widthRatio:.1,arrowStyle:[]}),a.registerJSONType("StraightArrow"),n.DrawTool.registerMode("StraightArrow",{action:"clickDblclick",create:function(t){return new a(t)},update:function(t,n){n.setCoordinates(t)},generate:function(t){return t}});var h=function(t){function n(){return o(this,n),u(this,t.apply(this,arguments))}return s(n,t),n.fromJSON=function(t){var e=t.feature,r=new n(e.geometry.coordinates,t.options);return r.setProperties(e.properties),r},n.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DiagonalArrow"}},n.prototype._getPaintParams=function(){var t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var n=this.getMap().getGLScale(),e=this._get2DLength(),r=e*this.options.widthRatio,o=i.getArrowBody(t,r,this.getMap(),.15,e),s=o[0][o[0].length-1],u=o[1][o[1].length-1],a=this._getArrowHead(s,u,t[t.length-1],.3*r,2),h=[];h.push.apply(h,o[0]),h.push.apply(h,a);for(var c=o[1].length-1;c>=0;c--)h.push(o[1][c]);return h=h.map(function(t){return t.multi(n)}),[h,[o[0].length,a.length,o[1].length]]},n}(a);h.mergeOptions({widthRatio:.2,arrowStyle:[]}),h.registerJSONType("DiagonalArrow"),n.DrawTool.registerMode("DiagonalArrow",{action:"clickDblclick",create:function(t){return new h(t)},update:function(t,n){n.setCoordinates(t)},generate:function(t){return t}});var c=function(t){function n(){return o(this,n),u(this,t.apply(this,arguments))}return s(n,t),n.fromJSON=function(t){var e=t.feature,r=new n(e.geometry.coordinates,t.options);return r.setProperties(e.properties),r},n.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DoveTailDiagonalArrow"}},n.prototype._closeArrow=function(t,n,e){var i=new r(n.x,n.y),o=new r(e.x,e.y),s=new r(i.x+o.x,i.y+o.y).mult(.5),u=i.dist(o),a=i.sub(o)._unit()._perp(),h=s.x+.618*u*a.x,c=s.y+.618*u*a.y;t.lineTo(h,c),t.closePath()},n}(h);c.mergeOptions({widthRatio:.2,arrowStyle:[]}),c.registerJSONType("DoveTailDiagonalArrow"),n.DrawTool.registerMode("DoveTailDiagonalArrow",{action:"clickDblclick",create:function(t){return new c(t)},update:function(t,n){n.setCoordinates(t)},generate:function(t){return t}}),t.StraightArrow=a,t.DiagonalArrow=h,t.DoveTailDiagonalArrow=c,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.plotsymbol v0.2.0, requires maptalks@>=0.36.2.")});